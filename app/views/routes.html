<div class="root">

  <main-menu></main-menu>

  <div class="main-container">

    <section-header ng-show="('routes' | routeSegmentEqualsTo)"
                    title="Routes"
                    icon="{{routes.icons.routes}}"
                    show-search-input="true">
    </section-header>

    <section-header ng-show="('routes.new_route' | routeSegmentEqualsTo)"
                    title="Routes - New Route"
                    icon="{{routes.icons.routes}}"
                    show-search-input="false"
                    show-close="true"
                    close-function="routes.goToRoutes()">
    </section-header>

    <section-header ng-show="('routes.edit_route.route_id' | routeSegmentEqualsTo)"
                    title="Routes - Edit Route"
                    icon="{{routes.icons.routes}}"
                    show-search-input="false"
                    show-close="true"
                    close-function="routes.goToRoutes()">
    </section-header>

    <div class="main-container-inner" ng-show="('routes' | routeSegmentEqualsTo)">

      <table class="tabla">
        <thead>
        <tr>
          <th>Name</th>
          <th>City</th>
          <th>Province</th>
          <th>Country</th>
          <th>Challenges</th>
          <th class="option-header">Options</th>
        </tr>
        </thead>
        <tbody ng-repeat="route in routes.routes track by $index">
        <tr>

          <td class="bold">{{route.route_name}}</td>
          <td>{{route.route_city}}</td>
          <td>{{route.route_province}}</td>
          <td>{{route.route_country}}</td>
          <td>{{route.challenges.length}}</td>
          <td class="option">

            <div class="rombo-table small-square edit-bg" ng-click="routes.editRoute(route.route_id)">
              <i class="{{routes.icons.edit}} icon-size"></i>
            </div>
            <!--ng-click="routes.deleteRow($index)"-->
            <div class="rombo-table small-square delete-bg" ng-click="showDeletePopup[$index] = !showDeletePopup[$index]">
              <i class="{{routes.icons.deleteDocument}} icon-size"></i>
            </div>
            <!--ng-click="showOptions[$index] = !showOptions[$index]"-->
            <div class="rombo-table small-square see-bg"
                 ng-class="{ 'rombo-table-see-selected' : showChallenges[$index] === true }"
                 ng-click="showChallenges[$index] = !showChallenges[$index]; routes.getChallengesByRouteId($index)">
              <i class="{{routes.icons.details}} icon-size"></i>
            </div>

            <div class="bg-popup" ng-show="showDeletePopup[$index]">

              <div class="popup-container">
                <span>are you sure you want to delete this route?</span>
                <h5 class="bold">{{route.route_name}}</h5>
                <div class="popup-buttons-container">
                  <button class="delete-button" ng-click="routes.deleteRoute(route.route_id); showDeletePopup[$index] = false">Delete</button>
                  <button class="cancel-button"  ng-click="showDeletePopup[$index] = false">Cancel</button>
                </div>
              </div>

            </div>

          </td>
        </tr>
        <tr ng-show="showChallenges[$index] === true">
          <td colspan="7">
            <table id="table-2" class="table-see">
              <tr>
                <th scope="col">Title</th>
                <th scope="col">Category</th>
                <th scope="col">Description</th>
                <th scope="col">Target</th>
                <th scope="col">Unit</th>
                <th scope="col">Instructions</th>
                <th scope="col">Reward</th>
                <th scope="col">Video</th>
                <th scope="col" class="option-header">Options</th>
              </tr>
              <tr ng-repeat="challenge in routes.challengesLoaded">
                <td class="bold">{{challenge.title}}</td>
                <td>{{challenge.category}}</td>
                <td>{{challenge.description}}</td>
                <td>{{challenge.target}}</td>
                <td>{{challenge.unit}}</td>
                <td>{{challenge.instructions}}</td>
                <td>{{challenge.reward}}</td>
                <td>{{challenge.video}}</td>
                <td class="option">

                  <div class="rombo-table small-square edit-bg" ng-click="routes.editChallenge(challenge.challenge_id)">
                    <i class="{{routes.icons.edit}} icon-size"></i>
                  </div>

                  <div class="rombo-table small-square delete-bg" ng-click="showDeletePopup[$index] = !showDeletePopup[$index]">
                    <i class="{{routes.icons.deleteDocument}} icon-size"></i>
                  </div>

                  <!-- TODO Hacer Directiva -->

                  <div class="bg-popup" ng-show="showDeletePopup[$index]">

                    <div class="popup-container">
                      <span>are you sure you want to delete this challenge?</span>
                      <h5 class="bold">{{challenge.title}}</h5>
                      <div class="popup-buttons-container">
                        <button class="delete-button" ng-click="routes.deleteChallenge(challenge.challenge_id); showDeletePopup[$index] = false">Delete</button>
                        <button class="cancel-button"  ng-click="showDeletePopup[$index] = false">Cancel</button>
                      </div>
                    </div>

                  </div>
                </td>
              </tr>

            </table>
          </td>
        </tr>

        </tbody>

      </table>

    </div>

    <div app-view-segment="1" ng-show="('routes.new_route' | routeSegmentEqualsTo)"></div>

    <div app-view-segment="2" ng-show="('routes.edit_route.route_id' | routeSegmentEqualsTo)"></div>

    <new-button icon="{{routes.icons.add}}"
                title="New Route"
                button-function="routes.goToNewRoute()"
                ng-hide="('routes.new_route' | routeSegmentEqualsTo)">
    </new-button>

  </div>


</div>
